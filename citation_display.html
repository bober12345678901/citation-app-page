<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Completed Citation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="theme.js"></script>
    <style>
        /* Any custom overrides if needed */
        .citation-output-container pre strong {
            color: inherit; /* Ensure strong tags are readable with text color */
        }
    </style>
</head>
<body class="min-h-screen theme-app-container">
    <div class="flex items-center justify-center min-h-screen w-full py-8">
        <div class="theme-lookup-box p-8 rounded-xl shadow-lg w-full max-w-2xl mx-4 sm:mx-auto transition-colors duration-300 border border-solid my-auto">
            <h2 class="theme-title text-3xl font-bold text-center mb-6">Completed Citation</h2>
            <div class="citation-output-container theme-label">
                </div>

            <div class="flex flex-wrap justify-center gap-4 mt-8">
                <button onclick="window.location.href='citation.html'" class="theme-button-secondary py-2 px-6 rounded-md font-semibold">Back to Citation Form</button>
                <button onclick="copyCitationText()" class="theme-button-secondary py-2 px-6 rounded-md font-semibold">Copy Text</button>
                <button onclick="window.location.href='selection.html'" class="theme-button-secondary py-2 px-6 rounded-md font-semibold">Back to Selection</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get the stored data from sessionStorage
            const storedData = sessionStorage.getItem('lastSubmittedCitation');
            let citationData = {};
            if (storedData) {
                citationData = JSON.parse(storedData);
                // Optionally clear it after reading if you only want to show it once
                sessionStorage.removeItem('lastSubmittedCitation'); // Clear after use
            } else {
                console.warn("No 'lastSubmittedCitation' found in sessionStorage. Displaying default values.");
                // You might want to redirect back if no data is found, e.g.:
                // window.location.href = 'selection.html';
            }

            const citationOutputContainer = document.querySelector('.citation-output-container');

            // Function to get a value from the retrieved citationData object or a default 'N/A'
            const getCitationValue = (key, defaultValue = 'N/A') => citationData[key] || defaultValue;

            // Prepare the values from citationData
            const citationNumber = getCitationValue('citationNumber');
            const dateIssued = getCitationValue('dateIssued');
            const timeIssued = getCitationValue('timeIssued');
            const officerBadge = getCitationValue('officerBadge');
            const officerName = getCitationValue('officerName');
            const officerRank = getCitationValue('officerRank');
            const violatorName = getCitationValue('violatorName');
            const violationType = getCitationValue('violationType');
            const penalCode = getCitationValue('penalCode');
            // Ensure totalAmountDue is parsed as float before toFixed
            const totalAmountDue = parseFloat(getCitationValue('totalAmountDue', '0')).toFixed(2);
            const additionalNotes = getCitationValue('violationDetails');
            const courtDate = getCitationValue('courtDate');

            // Format the output as per your request
            const citationText = `

Ping User Receiving Ticket: **@${violatorName.replace(/\s/g, '')}**
Type of Ticket: **${violationType}**
Penal Code: **${penalCode}**
Total Amount Due: **$${totalAmountDue}**
Additional Notes: ${additionalNotes}

Department Name: **WSP**
Rank and Signature: **${officerRank}**
Law Enforcement Name(s): **${officerName}**
Badge Number: **${officerBadge}**

By signing this citation, you acknowledge that this is NOT an admission of guilt, it is to simply ensure the citation is taken care of. Your court date is shown below, and failure to show will result in a warrant for your arrest. If you have any questions, please contact a Supervisor. 

**You must pay the citation to @panbober**

Sign at the X:
X ________________________

4000 Capitol Drive, Greenville, Wisconsin 54942 

Court date: **${courtDate}**
Please contact a Supervisor for further inquiry.
`;
            citationOutputContainer.innerHTML = `<pre id="citationContent" class="theme-label">${citationText}</pre>`;

            // Function to copy text
            window.copyCitationText = function() {
                const textToCopy = document.getElementById('citationContent').innerText;
                navigator.clipboard.writeText(textToCopy).then(() => {
                    alert('Citation text copied to clipboard!');
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy text. Please try again or copy manually.');
                });
            };
        });
    </script>
</body>
</html>